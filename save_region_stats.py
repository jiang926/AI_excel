#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import re
import os
import pandas as pd


RAW = r"""
地    区	6岁及以上死亡人口			未上过学			小    学 			初    中			高    中			大学专科 			大学本科 			研究生				



	合计	男	女	小计	男	女	小计	男	女	小计	男	女	小计	男	女	小计	男	女	小计	男	女	小计	男	女		

全    国	7317214	4235642	3081572	2618070	992413	1625657	3080607	1997842	1082765	1269887	972446	297441	264490	206725	57765	52870	41445	11425	30149	23935	6214	1141	836	305		

北    京	77005	44456	32549	19205	5717	13488	25267	15634	9633	17988	12849	5139	7959	5515	2444	2578	1836	742	3835	2772	1063	173	133	40		

天    津	53368	29514	23854	15673	4694	10979	20232	12111	8121	11804	8545	3259	3886	2791	1095	987	765	222	770	600	170	16	8	8		

河    北	445763	255220	190543	142721	51443	91278	202807	126793	76014	83561	63718	19843	13387	10693	2694	2295	1766	529	944	774	170	48	33	15		

山    西	190267	111923	78344	55744	21928	33816	83138	51258	31880	41963	31295	10668	7350	5777	1573	1479	1176	303	573	474	99	20	15	5		

内 蒙 古	114647	71023	43624	37690	16812	20878	45299	29409	15890	24228	18911	5317	5579	4415	1164	1343	1061	282	494	404	90	14	11	3		

辽    宁	280112	162798	117314	65907	21927	43980	119991	71623	48368	74530	54259	20271	14116	10623	3493	3470	2663	807	2057	1670	387	41	33	8		

吉    林	134987	79217	55770	31550	13057	18493	60104	34907	25197	32849	23291	9558	8149	6139	2010	1498	1169	329	820	642	178	17	12	5		

黑 龙 江	192877	117463	75414	41426	18055	23371	87501	52527	34974	50168	36435	13733	10623	7960	2663	2156	1671	485	979	797	182	24	18	6		

上    海	113601	60859	52742	30221	7255	22966	37964	20951	17013	27444	19567	7877	11666	8304	3362	2667	1981	686	3541	2720	821	98	81	17		

江    苏	486787	266731	220056	177087	54668	122419	206908	131409	75499	81018	63400	17618	16855	13324	3531	3105	2467	638	1744	1409	335	70	54	16		

浙    江	293632	168453	125179	125701	46804	78897	121316	85222	36094	35296	27578	7718	8496	6657	1839	1794	1411	383	1003	766	237	26	15	11		

安    徽	346576	200450	146126	177974	72658	105316	108444	78545	29899	48971	39944	9027	8313	6904	1409	1827	1498	329	1017	880	137	30	21	9		

福    建	182247	104810	77437	54009	16002	38007	87622	55515	32107	30776	25164	5612	7474	6189	1285	1420	1154	266	898	753	145	48	33	15		

江    西	228216	135774	92442	74715	27148	47567	103810	68655	35155	38897	31060	7837	8585	7081	1504	1605	1326	279	584	491	93	20	13	7		

山    东	596626	334129	262497	262560	98330	164230	223776	149122	74654	88868	69345	19523	17229	14016	3213	2929	2334	595	1211	943	268	53	39	14		

河    南	506095	292167	213928	214507	89456	125051	179837	116563	63274	93036	71163	21873	15359	12325	3034	2495	1959	536	809	664	145	52	37	15		

湖    北	304378	175265	129113	120939	43835	77104	116341	79415	36926	52646	40613	12033	11513	9035	2478	1937	1548	389	957	784	173	45	35	10		

湖    南	373363	217366	155997	107377	40842	66535	186800	117028	69772	64149	47740	16409	12402	9666	2736	1844	1448	396	737	607	130	54	35	19		

广    东	437389	251334	186055	128466	39935	88531	202171	128777	73394	81231	62452	18779	20659	16308	4351	3243	2572	671	1536	1240	296	83	50	33		

广    西	246398	150660	95738	68900	24732	44168	123193	81664	41529	43881	35582	8299	8194	6812	1382	1533	1281	252	678	575	103	19	14	5		

海    南	33662	20271	13391	12020	4206	7814	11728	7976	3752	7637	6130	1507	1834	1583	251	303	263	40	131	106	25	9	7	2		

重    庆	183304	107957	75347	59450	22766	36684	91393	60565	30828	26697	20235	6462	4451	3363	1088	729	576	153	564	434	130	20	18	2		

四    川	525894	307464	218430	196429	77243	119186	245347	165548	79799	71036	54573	16463	10210	7832	2378	1906	1487	419	942	763	179	24	18	6		

贵    州	200011	119522	80489	89088	37181	51907	77099	54834	22265	27971	22775	5196	4309	3482	827	1051	867	184	473	368	105	20	15	5		

云    南	278115	163199	114916	117092	49916	67176	118620	79992	38628	32555	25598	6957	7454	5804	1650	1679	1307	372	695	565	130	20	17	3		

西    藏	14692	7915	6777	11041	5532	5509	3035	1974	1061	387	260	127	137	85	52	72	49	23	20	15	5					

陕    西	198966	114564	84402	71261	29471	41790	78642	48665	29977	38720	28466	10254	7955	6094	1861	1520	1177	343	812	653	159	56	38	18		

甘    肃	134040	78295	55745	64124	29595	34529	47881	31459	16422	16477	12910	3567	4232	3303	929	941	720	221	370	297	73	15	11	4		

青    海	28406	16429	11977	12708	5671	7037	10549	6758	3791	3668	2903	765	991	728	263	364	261	103	121	104	17	5	4	1		

宁    夏	30558	18351	12207	13045	5921	7124	9995	6604	3391	5652	4379	1273	1171	916	255	376	282	94	315	245	70	4	4			

新    疆	85232	52063	33169	19440	9613	9827	43797	26339	17458	15783	11306	4477	3952	3001	951	1724	1370	354	519	420	99	17	14	3		
"""


CATEGORIES = [
    ("6岁及以上死亡人口", "合计,男,女"),
    ("未上过学", "小计,男,女"),
    ("小学", "小计,男,女"),
    ("初中", "小计,男,女"),
    ("高中", "小计,男,女"),
    ("大学专科", "小计,男,女"),
    ("大学本科", "小计,男,女"),
    ("研究生", "小计,男,女"),
]

COLUMN_NAMES = ["地区"]
for cat, subs in CATEGORIES:
    for sub in subs.split(","):
        COLUMN_NAMES.append(f"{cat}_{sub}")


def parse_table(raw: str):
    rows = []
    for line in raw.splitlines():
        line = line.strip()
        if not line:
            continue
        # 跳过表头行
        if line.startswith("地") or line.startswith("合计") or "合计" in line and "男" in line and "女" in line:
            continue
        # 仅数字行或无中文名称的行跳过
        if re.fullmatch(r"[\d\s]+", line):
            continue

        m = re.match(r"^([^\d]+?)\s+([\d\s]+)$", line)
        if not m:
            continue
        region = m.group(1)
        # 规范地区名（去掉内部多余空格）
        region = re.sub(r"\s+", "", region)
        nums = [n for n in re.split(r"\s+", m.group(2).strip()) if n]
        # 转成整数
        values = []
        for n in nums:
            try:
                values.append(int(n.replace(",", "")))
            except Exception:
                values.append(None)
        # 目标应为 24 个数值（8*3），不足补齐
        if len(values) < 24:
            values += [None] * (24 - len(values))
        elif len(values) > 24:
            values = values[:24]
        row = [region] + values
        rows.append(row)
    df = pd.DataFrame(rows, columns=COLUMN_NAMES)
    return df


def main():
    df = parse_table(RAW)
    out_path = os.path.join("/mnt/sde/AI_excel", "地区学历统计.xlsx")
    df.to_excel(out_path, index=False)
    print(f"已保存: {out_path}（{len(df)} 行，{df.shape[1]} 列）")


if __name__ == "__main__":
    main()


